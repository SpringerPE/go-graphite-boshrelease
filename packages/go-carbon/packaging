# abort script on any command that exits with a non zero value
set -e -x

echo "Extracting go-carbon ..."
tar xvf go-carbon/go-carbon_0.7.tar.gz

echo "Setting the GO env variables ..."
export GOPATH=${BOSH_COMPILE_TARGET}/go-carbon-0.7/_vendor
export GOROOT=$(readlink -nf /var/vcap/packages/golang1.6)
export PATH=${GOROOT}/bin:${PATH}

echo "Installing go-carbon ..."
pushd go-carbon-0.7
  go build -o go-carbon
  mkdir -p ${BOSH_INSTALL_TARGET}/bin
  install -m 0755 go-carbon ${BOSH_INSTALL_TARGET}/bin
  # go-carbon --config-print-default > /usr/local/etc/carbon.conf
popd
