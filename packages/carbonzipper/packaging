# abort script on any command that exits with a non zero value
set -e -x

echo "Extracting carbonzipper ..."
tar xvf carbonzipper/carbonzipper-462ed6c.tar.gz

echo "Setting the GO env variables ..."
export GOPATH=${BOSH_COMPILE_TARGET}/carbonzipper-462ed6c
export GOROOT=$(readlink -nf /var/vcap/packages/golang1.6)
export PATH=${GOROOT}/bin:${PATH}

echo "Installing carbonzipper ..."
pushd carbonzipper-462ed6c
  go build -o carbonzipper
  mkdir -p ${BOSH_INSTALL_TARGET}/bin
  install -m 0755 carbonzipper ${BOSH_INSTALL_TARGET}/bin
popd
